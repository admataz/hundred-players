{
  "version": 3,
  "file": "bundle.css",
  "sources": [
    "../client/Arena.svelte",
    "../client/Ball.svelte",
    "../client/Player.svelte",
    "../client/Goal.svelte",
    "../client/Score.svelte",
    "../client/Controls.svelte",
    "../client/App.svelte"
  ],
  "sourcesContent": [
    "<script>\n  import { createEventDispatcher } from \"svelte\";\n  import Player from \"./Player.svelte\";\n  import Ball from \"./Ball.svelte\";\n  import Goal from \"./Goal.svelte\";\n  export let playerPositions = {};\n  export let renderedPlayers = [];\n  export let currentPlayers = [];\n  export let ballPos = {\n    xPos: 200,\n    yPos: 100,\n    speed: 0,\n    hForce: 1,\n    vForce: 1\n  };\n\n  const dispatch = createEventDispatcher();\n\n  export let playerFriction = 0.2;\n  export let ballFriction = 0.1;\n\n  export let arenaSize = { width: 500, height: 200 };\n  export let goalSize = 100;\n\n  const animStep = () => {\n    Object.entries(playerPositions).forEach(([key, p]) => {\n      if (p.speed > playerFriction / 2) {\n        p.speed -= playerFriction;\n      } else {\n        p.speed = 0;\n      }\n      if (ballPos.speed > ballFriction / 2) {\n        ballPos.speed -= ballFriction;\n      } else {\n        ballPos.speed = 0;\n      }\n\n      const newxPos = p.xPos + p.hForce * p.speed;\n      if (0 < newxPos && arenaSize.width > newxPos) {\n        p.xPos = newxPos;\n      }\n\n      const newyPos = p.yPos + p.vForce * p.speed\n      if (0 <  newyPos && arenaSize.height > newyPos) {\n        p.yPos = newyPos\n      }\n\n      if (\n        Math.abs(ballPos.xPos - p.xPos) < 20 &&\n        Math.abs(ballPos.yPos - p.yPos) < 20\n      ) {\n        ballPos.speed = p.speed * 1.5;\n        if (p.xPos > ballPos.xPos) {\n          ballPos.hForce = -1 * Math.random();\n          ballPos.xPos -= 10;\n        } else {\n          ballPos.hForce = Math.random();\n          ballPos.xPos += 10;\n        }\n\n        if (p.yPos > ballPos.yPos) {\n          ballPos.yPos -= 10;\n          ballPos.vForce = -1 * Math.random();\n        } else {\n          ballPos.yPos += 10;\n          ballPos.vForce = Math.random();\n        }\n        dispatch(\"ballcollide\", ballPos);\n      }\n    });\n\n    renderedPlayers = currentPlayers.map(m => ({\n      ...m,\n      ...playerPositions[m.id]\n    }));\n\n    if (ballPos.xPos >= arenaSize.width) {\n      if (\n        arenaSize.height / 2 - goalSize / 2 < ballPos.yPos &&\n        arenaSize.height / 2 + goalSize / 2 > ballPos.yPos\n      ) {\n        dispatch(\"goooooal\", \"right\");\n      } else {\n        ballPos.hForce = -1;\n      }\n    }\n\n    if (ballPos.xPos < 0) {\n      if (\n        arenaSize.height / 2 - goalSize / 2 < ballPos.yPos &&\n        arenaSize.height / 2 + goalSize / 2 > ballPos.yPos\n      ) {\n        dispatch(\"goooooal\", \"left\");\n      } else {\n        ballPos.hForce = 1;\n      }\n    }\n\n    if (ballPos.yPos >= arenaSize.height) {\n      ballPos.vForce = -1;\n    }\n\n    if (ballPos.yPos < 0) {\n      ballPos.vForce = 1;\n    }\n\n    ballPos = {\n      ...ballPos,\n      xPos: ballPos.xPos + ballPos.hForce * ballPos.speed,\n      yPos: ballPos.yPos + ballPos.vForce * ballPos.speed\n    };\n    window.requestAnimationFrame(animStep);\n  };\n\n  animStep();\n\n  // $: console.log(playerPositions);\n</script>\n\n<style>\n  main {\n    border: 1px solid #000;\n    position: relative;\n  }\n</style>\n\n<main style=\"width:{arenaSize.width}px; height: {arenaSize.height}px\">\n\n  <Goal side=\"left\" />\n  <Goal side=\"right\" />\n  <Ball {...ballPos} />\n  {#each renderedPlayers as player}\n    <Player {player} xPos={player.xPos} yPos={player.yPos} />\n  {/each}\n\n  <svg />\n</main>\n",
    "<script>\n  export let xPos = 0;\n  export let yPos = 0;\n</script>\n\n<style>\n  .ball {\n    position: absolute;\n    border: 1px solid #000;\n    border-radius: 50%;\n    width: 20px;\n    height: 20px; \n  }\n</style>\n\n<div class=\"ball\" style=\"top:{`${yPos}px`}; left:{`${xPos}px`}\" />\n",
    "<script>\n  export let player;\n  export let xPos = 0;\n  export let yPos = 0;\n</script>\n\n<style>\n  .player {\n    position: absolute;\n    border: 2px solid #000;\n    padding: 2px;\n    border-radius: 5px;\n  }\n  .team-0{\n      border-color: red\n  }\n\n  .team-1{\n      border-color: blue;\n  }\n</style>\n\n<div class=\"player team-{player.team}\" style=\"top:{`${yPos}px`}; left:{`${xPos}px`}\">{player.info.name}</div>\n",
    "<script>\n  export let side = \"left\";\n  export let size = 80;\n  export let pos = 20;\n</script>\n\n<style>\n  .goal {\n    border: 1px solid #000;\n    width: 10px;\n    position: absolute;\n  }\n</style>\n\n<div class=\"goal\" style=\"height:{size}px; top:{pos}px;  bottom:{pos}px; {side}:0\" />\n",
    "<script>\n    export let scoreline = [0,0]\n    \n</script>\n\n<style>\n.scoreboard{\n    display: flex;\n    justify-content: center;\n}\n.score{\n    border-radius: 10px;\n    background: black;\n    color: gold;\n    padding: 10px;\n    flex: 0 1 64px;\n    margin: 4px;\n    text-align: center;\n    font-size: 32px;\n\n}\n\n.team {\n    width: 10px;\nmargin: 4px;\n}\n\n.team-1{\n    background-color: red;\n}\n\n.team-0{\n    background-color: blue;\n}\n\n</style>\n\n\n<div class=\"scoreboard\">\n    <div class=\"team team-1\"></div>\n    <div class=\"score\">{scoreline[1]}</div>\n    <div class=\"score\">{scoreline[0]}</div>\n    <div class=\"team team-0\"></div>\n</div>",
    "<script>\n  import { createEventDispatcher } from \"svelte\";\n  const dispatch = createEventDispatcher();\n\n  export let dir = { hForce: 0, vForce: 0 };\n  export let activeKeys = new Map();\n  export let sequence = \"\";\n\n  function goLeft() {\n    sequence = `${sequence}h`;\n    dir = { vForce: 0, hForce: -1 };\n  }\n\n  function goRight() {\n    sequence = `${sequence}l`;\n    dir = { vForce: 0, hForce: 1 };\n  }\n\n  function goUp() {\n    sequence = `${sequence}k`;\n    dir = { hForce: 0, vForce: -1 };\n  }\n\n  function goDown() {\n    sequence = `${sequence}j`;\n    dir = { hForce: 0, vForce: 1 };\n  }\n\n  function hitA() {\n    sequence = `${sequence}a`;\n  }\n  function hitB() {\n    sequence = `${sequence}b`;\n  }\n\n  function goStop() {\n    dir = { vForce: 0, hForce: 0 };\n  }\n\n  const onKeyDown = evt => {\n    // debounce\n    if (activeKeys.get(evt.key)) {\n      return;\n    }\n    activeKeys.set(evt.key, true);\n\n    switch (evt.key) {\n      case \"j\":\n      case \"ArrowDown\":\n        goDown();\n        return;\n      case \"k\":\n      case \"ArrowUp\":\n        goUp();\n        return;\n      case \"h\":\n      case \"ArrowLeft\":\n        goLeft();\n        return;\n      case \"l\":\n      case \"ArrowRight\":\n        goRight();\n        return;\n      case \"a\":\n        hitA();\n        return;\n      case \"b\":\n        hitB();\n        return;\n      default:\n        return null;\n    }\n  };\n\n  const onKeyUp = evt => {\n    activeKeys.set(evt.key, false);\n    if (sequence.match(\"kkjjhlhlba\")) {\n      console.log(\"Konami!!\");\n      sequence = \"\";\n    }\n    switch (evt.key) {\n      case \"j\":\n      case \"ArrowDown\":\n      case \"k\":\n      case \"ArrowUp\":\n      case \"h\":\n      case \"ArrowLeft\":\n      case \"l\":\n      case \"ArrowRight\":\n        goStop();\n        return;\n      default:\n        return null;\n    }\n  };\n  $: dispatch(\"controls\", dir);\n</script>\n\n<style>\n.controls-container{\n    bottom: 0;\n    width: 100%;\n\n}\n  .controls {\n    display: flex;\n    flex-direction: column;\n    width: 100%;\n    border: 1px solid #000;\n      \n  }\n  .controls .button-row{\n      display: flex;\n      width: 100%;\n      justify-content: center;\n      align-content: center;\n  }\n\n  button{\n      flex: 1;\n      margin: 2px;\n      max-width: 100px;\n      height: 48px;\n      border-radius: 21px;\n      border-color: #000;\n      border-width: 4px;\n  }\n  .minor-buttons button{\n      padding: 2px;\n      height: 42px;\n      max-width: 42px \n  }\n</style>\n\n<svelte:window on:keydown={onKeyDown} on:keyup={onKeyUp} />\n<div class=\"controls-container\">\n<div class=\"controls\">\n  <div class=\"button-row minor-buttons\">\n    <button on:mousedown={hitA} on:mouseup={goStop}>A</button>\n    <button on:mousedown={hitB} on:mouseup={goStop}>B</button>\n  </div>\n  <div class=\"button-row\">\n    <button on:mousedown={goUp} on:mouseup={goStop}>Up</button>\n  </div>\n  <div class=\"button-row\">\n    <button on:mousedown={goLeft} on:mouseup={goStop}>left</button>\n    <button on:mousedown={goRight} on:mouseup={goStop}>right</button>\n  </div>\n  <div class=\"button-row\">\n    <button on:mousedown={goDown} on:mouseup={goStop}>down</button>\n  </div>\n</div>\n\n</div>\n",
    "<script>\n  import Pusher from \"pusher-js\";\n  import Login from \"./Login.svelte\";\n  import Controls from \"./Controls.svelte\";\n  import Arena from \"./Arena.svelte\";\n  import Score from \"./Score.svelte\";\n\n  export let pusher = null;\n  export let usertoken = null;\n  export let pusherChannel = null;\n  export let isGameHost = false;\n\n  let currentPlayers = [];\n  let me = null;\n  let playerPositions = {};\n  let playerDefaultStartPos = {\n    xPos: 0,\n    yPos: 0,\n    vForce: 0,\n    hForce: 0,\n    speed: 7\n  };\n  let startBallPos = {\n    xPos: 100,\n    yPos: 100,\n    speed: 0,\n    hForce: 1,\n    vForce: 1\n  };\n  let ballPos = { ...startBallPos };\n  let scoreline = [0, 0];\n  let arenaSize = { width: 500, height: 200 };\n\n  const setCurrentMembers = pusherMembers => {\n    const members = [];\n    if (!pusherMembers) {\n      return members;\n    }\n    pusherMembers.each(m => {\n      members.push(m);\n    });\n\n    isGameHost = pusherChannel.members.me.id === members[0].id;\n    return members;\n  };\n\n  const pusherInit = () => {\n    pusher = new Pusher(\"5682fcdf7df3eb814416\", {\n      cluster: \"eu\",\n      forceTLS: true,\n      auth: {\n        headers: {\n          authorization: `Bearer ${usertoken}`\n        }\n      }\n    });\n\n    pusherChannel = pusher.subscribe(\"presence-lnug-channel\");\n\n    pusherChannel.bind(\"pusher:subscription_succeeded\", function(members) {\n      currentPlayers = setCurrentMembers(pusherChannel.members);\n      me = pusherChannel.members.me;\n      const team = currentPlayers.length % 2;\n\n      updatePlayerPositions(me.id, {\n        ...playerDefaultStartPos,\n        team,\n        xPos: team ? arenaSize.width - 10 : 10,\n        yPos: Math.random() * arenaSize.height\n      });\n    });\n\n    pusherChannel.bind(\"pusher:member_added\", function(member) {\n      currentPlayers = setCurrentMembers(pusherChannel.members);\n      pusherChannel.trigger(\"client-player-move\", playerPositions[me.id]);\n      if (isGameHost) {\n        pusherChannel.trigger(\"client-init\", { scoreline });\n      }\n    });\n\n    pusherChannel.bind(\"pusher:member_removed\", function(member) {\n      currentPlayers = setCurrentMembers(pusherChannel.members);\n    });\n\n    pusherChannel.bind(\"client-player-move\", function(data, meta) {\n      updatePlayerPositions(meta.user_id, data);\n    });\n\n    pusherChannel.bind(\"client-ball-bounce\", function(data, meta) {\n      updateBallPosition(data);\n    });\n\n    pusherChannel.bind(\"client-init\", function({ scoreline }, meta) {\n      updateScoreline(scoreline);\n    });\n\n    pusherChannel.bind(\"client-goal\", function(data, meta) {\n      updateScoreline(data);\n      updateBallPosition(startBallPos);\n    });\n  };\n\n  const onSubmit = async evt => {\n    const response = await fetch(\"/register\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({ username: evt.detail })\n    });\n\n    const data = await response.json();\n    usertoken = data.token;\n\n    if (usertoken) {\n      pusherInit();\n    }\n  };\n\n  const updatePlayerPositions = (id, position) => {\n    playerPositions = {\n      ...playerPositions,\n      [id]: position\n    };\n  };\n\n  const updateBallPosition = newBallPos => {\n    ballPos = {\n      ...startBallPos,\n      ...newBallPos\n    };\n  };\n\n  const updateScoreline = newScoreline => {\n    scoreline = newScoreline;\n  };\n\n  const onPlayerControl = evt => {\n    const position = {\n      ...playerDefaultStartPos,\n      ...playerPositions[me.id],\n      ...evt.detail,\n      speed: 7\n    };\n    updatePlayerPositions(me.id, position);\n    pusherChannel.trigger(\"client-player-move\", position);\n  };\n\n  const onGoal = evt => {\n    const newScoreline = [...scoreline];\n    if (evt.detail === \"left\") {\n      newScoreline[0] += 1;\n    } else {\n      newScoreline[1] += 1;\n    }\n    if (isGameHost) {\n      ballPos = startBallPos;\n      updateScoreline(newScoreline);\n      pusherChannel.trigger(\"client-goal\", newScoreline);\n    }\n  };\n\n  const onBallCollide = evt => {\n    if (isGameHost) {\n      updateBallPosition(evt.detail);\n      pusherChannel.trigger(\"client-ball-bounce\", evt.detail);\n    }\n  };\n</script>\n\n<style>\n  .gamearea {\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    height: 100%;\n  }\n  .scoreboard{\n      flex: 0 1 0;\n      background-color: #999;\n  }\n  .arena{\n      flex: 1\n\n  }\n  .controls{\n    background-color: #efefef;\n      flex: 0 1 0;\n  }\n \n\n\n</style>\n\n{#if !usertoken}\n\n  <Login on:submit={onSubmit} />\n{:else}\n\n  <div class=\"gamearea\">\n    <div class=\"scoreboard\">\n      <Score {scoreline} />\n    </div>\n\n    <div class=\"arena\">\n      <Arena\n        {playerPositions}\n        {currentPlayers}\n        {ballPos}\n        on:ballcollide={onBallCollide}\n        on:goooooal={onGoal} />\n    </div>\n\n    <div class=\"controls\">\n      <Controls on:controls={onPlayerControl} />\n      <div class=\"greeting\">\n        {#if me}Hello {me.info.name}!{/if}\n      </div>\n    </div>\n\n\n  </div>\n{/if}\n"
  ],
  "names": [],
  "mappings": "AAwHE,IAAI,eAAC,CAAC,AACJ,MAAM,CAAE,GAAG,CAAC,KAAK,CAAC,IAAI,CACtB,QAAQ,CAAE,QAAQ,AACpB,CAAC;ACrHD,KAAK,eAAC,CAAC,AACL,QAAQ,CAAE,QAAQ,CAClB,MAAM,CAAE,GAAG,CAAC,KAAK,CAAC,IAAI,CACtB,aAAa,CAAE,GAAG,CAClB,KAAK,CAAE,IAAI,CACX,MAAM,CAAE,IAAI,AACd,CAAC;ACLD,OAAO,cAAC,CAAC,AACP,QAAQ,CAAE,QAAQ,CAClB,MAAM,CAAE,GAAG,CAAC,KAAK,CAAC,IAAI,CACtB,OAAO,CAAE,GAAG,CACZ,aAAa,CAAE,GAAG,AACpB,CAAC,AACD,qBAAO,CAAC,AACJ,YAAY,CAAE,GAAG;EACrB,CAAC,AAED,qBAAO,CAAC,AACJ,YAAY,CAAE,IAAI,AACtB,CAAC;ACZD,KAAK,cAAC,CAAC,AACL,MAAM,CAAE,GAAG,CAAC,KAAK,CAAC,IAAI,CACtB,KAAK,CAAE,IAAI,CACX,QAAQ,CAAE,QAAQ,AACpB,CAAC;ACLH,yBAAW,CAAC,AACR,OAAO,CAAE,IAAI,CACb,eAAe,CAAE,MAAM,AAC3B,CAAC,AACD,oBAAM,CAAC,AACH,aAAa,CAAE,IAAI,CACnB,UAAU,CAAE,KAAK,CACjB,KAAK,CAAE,IAAI,CACX,OAAO,CAAE,IAAI,CACb,IAAI,CAAE,CAAC,CAAC,CAAC,CAAC,IAAI,CACd,MAAM,CAAE,GAAG,CACX,UAAU,CAAE,MAAM,CAClB,SAAS,CAAE,IAAI,AAEnB,CAAC,AAED,KAAK,cAAC,CAAC,AACH,KAAK,CAAE,IAAI,CACf,MAAM,CAAE,GAAG,AACX,CAAC,AAED,qBAAO,CAAC,AACJ,gBAAgB,CAAE,GAAG,AACzB,CAAC,AAED,qBAAO,CAAC,AACJ,gBAAgB,CAAE,IAAI,AAC1B,CAAC;ACkED,iCAAmB,CAAC,AAChB,MAAM,CAAE,CAAC,CACT,KAAK,CAAE,IAAI,AAEf,CAAC,AACC,SAAS,cAAC,CAAC,AACT,OAAO,CAAE,IAAI,CACb,cAAc,CAAE,MAAM,CACtB,KAAK,CAAE,IAAI,CACX,MAAM,CAAE,GAAG,CAAC,KAAK,CAAC,IAAI,AAExB,CAAC,AACD,uBAAS,CAAC,yBAAW,CAAC,AAClB,OAAO,CAAE,IAAI,CACb,KAAK,CAAE,IAAI,CACX,eAAe,CAAE,MAAM,CACvB,aAAa,CAAE,MAAM,AACzB,CAAC,AAED,oBAAM,CAAC,AACH,IAAI,CAAE,CAAC,CACP,MAAM,CAAE,GAAG,CACX,SAAS,CAAE,KAAK,CAChB,MAAM,CAAE,IAAI,CACZ,aAAa,CAAE,IAAI,CACnB,YAAY,CAAE,IAAI,CAClB,YAAY,CAAE,GAAG,AACrB,CAAC,AACD,4BAAc,CAAC,oBAAM,CAAC,AAClB,OAAO,CAAE,GAAG,CACZ,MAAM,CAAE,IAAI,CACZ,SAAS,CAAE,IAAI;EACnB,CAAC;ACwCD,SAAS,cAAC,CAAC,AACT,OAAO,CAAE,IAAI,CACb,cAAc,CAAE,MAAM,CACtB,eAAe,CAAE,MAAM,CACvB,MAAM,CAAE,IAAI,AACd,CAAC,AACD,yBAAW,CAAC,AACR,IAAI,CAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CACX,gBAAgB,CAAE,IAAI,AAC1B,CAAC,AACD,oBAAM,CAAC,AACH,IAAI,CAAE,CAAC;;EAEX,CAAC,AACD,uBAAS,CAAC,AACR,gBAAgB,CAAE,OAAO,CACvB,IAAI,CAAE,CAAC,CAAC,CAAC,CAAC,CAAC,AACf,CAAC"
}